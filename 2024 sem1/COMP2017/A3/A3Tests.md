# Author
Mingyuan Ba

# DATE
Fri May 10 00:21:12 AEST 2024
# AI used (yes/no)
yes, ChatGPT 4

# AI link
https://chat.openai.com/
## Usage of AI declaration:
  
`CHATGPT4` is used to assist in creating Python programs that modify specific chunks of .data binary files for testing with hashing functions and create a binary file of a specific `16kb` size. The programs are located in the `./resources/file_gen.py` and `./resources/modify_binary_file.py` directories. The files generated or modified by these programs are all stored in the `resources` directory, and no other AI-generated content is used.
### Prompt used to generate the python program:
**For `file_gen.py`:**
provide me with Python code that can create a binary file of a specified size with random data

**For `modify_binary_file.py`:**
provide me with Python code that can modify a chunk of data based on an offset

# Overview

The test consists of 2 parts:

- **Merkle Tree Data Structure and Corresponding Functions in `pkgchk.c`**: This part will use various normal and edge cases to test all functionalities described in the ByteTide specification.

- **`.bpkg` Files**: The handling of .bpkg file format issues will be tested by passing in different problematic .bpkg files. The script will check the exit codes and exit messages to determine if incorrectly computed bpkg can be identified and addressed properly.

# Instructions to run testing scripts

**Executable Directory**:
  - The `/bin` directory is designated for the executable file `pkgmain`. Please ensure that the `pkgmain` file is placed in this folder.

**Test Directories**:
  - The `/tests` directory contains two sub-directories: `/merkletree` and `/bpkg`.

**Merkle Tree Testing**:
  - To test the merkle tree implementation, `cd` to the `/merkle_tree` directory in the terminal and execute `run_merkle_test.sh`. This script runs all `runtest.sh` scripts in the sub-directories under `/merkletree`. Alternatively, you can also run these scripts individually by navigating to each sub-directory and executing `runtest.sh`.

**`bpkg` Testing**:
  - For testing `/bpackage`, navigate to the `/bppg` directory and execute `run_bpkg_test.sh` to run all `.bpkg` test cases.

**Resources**:
  - The `/resources` directory contains several tools for generating and modifying `.data` files (written in Python with assistance from ChatGPT), a package maker (`pkgmake`) (from scaffold), and files generated by these programs.

# Merkle Tree Tests

## get_all_hash Test Description
This test is designed to test the functionality of getting all hashes. We will pass arguments set in the `.in` file to `pkgmain` as the . `pkgmain` should output all the hashes contained in the `bpkg` files in the Merkle tree.

- **get_all_hashes_1**
	By passing the `16kb_og.bpkg` file and a flag `-all_hash` through `merkle_get_all_hash_1.in`, `pkgmain` should output all the hash values contained in `16kb_og.bpkg`.
	
## chunk_check Test Description

This test is designed to assess the functionality of getting all complete chunks. Similarly, we will pass the argument given in the `.in` file to `pkgmain`. `pkgmain` should check and output all complete chunks. By modifying different chunks of data in the original file `16kb_og.data`, we can simulate scenarios where different chunks are damaged.

- **merkle_chunk_check_1**:
	The input for this test includes the unmodified `16kb_og.data` file and `16kb_ob.bpkg`, which was created from the same unaltered data.Since `16kb_ob.bpkg` corresponds with the unmodified source file, `pkgmain` should verify and output the hash value for each chunk in the `16kb_og.data`, confirming all chunks as complete and intact.
	
- **merkle_chunk_check_2**:
	This test involves `16kb_bad_a.data`, where the third chunk has been intentionallycorrupted, and `16kb_ob.bpkg` created from the uncorrupted version of the file.`pkgmain` should output the hash values for all the chunks except for the third one. 
	
- **merkle_chunk_check_3**:
	The input consists of `16kb_bad_bad.data`, where every chunk is damaged, and `16kb_ob.bpkg` generated from a file where the data was intact.In this scenario, `pkgmain` should output nothing since all chunks in the data file are corrupted, and thus no hash checks should pass.
	
- **merkle_chunk_check_4**:
	For this test, `16kb_bad_b.data` is used where the first and last chunks are damaged, paired with `16kb_ob.bpkg` which was created from an undamaged file.`pkgmain` should successfully identify and output the hash values for all chunks except the first and last ones.

## min_hash Description
This test evaluates the functionality of `get_min_complete_hash`. We will continue to pass the path to the `bpkg` file and the flag `-min_hashes` via the `.in` file. We use the same file as before to test its performance on different damaged files.

- **merkle_min_hash_1**:
	The `.in` file provides the path to an intact `bpkg` file and includes the `-min_hashes` flag. In this test case, since all chunks are complete, `pkgmain` should process this without encountering any damaged chunks.The output should be the hash of the root node, representing the entire file integrity as undamaged.
	
- **merkle_min_hash_2**:
	The `.in` file directs to the `16kb_bad_a.data` file with the `-min_hashes` flag, where the third chunk is noted as damaged.The output should include the hash values of nodes directly related to the damaged third chunk, which are `node 7`, `node 18`, `node 4`, and `node 2`, with node indexing beginning at 0 and increasing in level order.
	
- **merkle_min_hash_3**:
	The input specifies the `16kb_bad_bad.data` file alongside the `-min_hashes` flag, where all chunks are damaged. Since all chunks are damaged, `pkgmain` should return no hash values.
- **merkle_min_hash_4**:
	This test uses `16kb_bad_b.data` file and the `-min_hashes` flag, where the first and last chunks are damaged. The expected output should be the hash values of the nodes directly connected to the damage: `node 16`, `node 8`, `node 4`, `node 5`, `node 13`, and `node 29`,with node indexing beginning at 0 and increasing in level order.

## hash_of Description
This test is designed to test the `hash_of` functionality. In the `.in` file, we provide the path to a `bpkg` file, the flag `-hashes_of`, and a hash value. `pkgmain` should search for and output all the hash values of chunks that correspond to this hash.

 - **merkle_hash_of_1**:   
	The `.in` file contains the path to a `bpkg` file, the `-hashes_of` flag, and the hash of the root node.`pkgmain` should return the hashes of all the chunks, as the root node represents the complete file.
 - **merkle_hash_of_2**:  
	In this testcase, after providing a hash of a chunk and flag `-hashes_of`, `pkgmain` should only return the hash of the current chunk.
- **merkle_hash_of_3**:  
	Provided with the hash of `node 3` using the `-hashes_of` flag.The program should output the hashes of `node 15` to `node 18`, which are directly related to node 3, with node indexing beginning at 0 and increasing in level order..

## file_check Description
This test is designed to check the functionality of `file_check`. If the file exists, the program should output `File Exists.` If it does not exist, the program should create the file. In `.in` files, we will still provide the path of `.bpkg` file and the flag `-file_check`.

- **merkle_file_check_1**:   
	The `.bpkg` file path is provided where the specified file exists in the specified location.`pkgmain` should output `File exists` acknowledging the presence of the file.

- **merkle_file_check_2**:   
	In this test,the `.bpkg` file path is given where the specified file does not exist in the location.`pkgmain` should create the missing file and output "File Created". This should be followed by a shell script that checks for the file's presence to confirm creation.


# BPKG Tests

For this part, we test whether the `pkgmain` can correctly check the format of the given `bpkg` files. If the format is incorrect, the program should exit with a non-zero exit code (our shell script checks for exit codes). Since we have already used and loaded the `bpkg` file in the previous section, we only test invalid bpkg files in this section.For the input of this test, we still write the path to the `bpkg` file and the flag as arguments for the `pkgmain` program in the `.in` file. We choose `-all_hash` as the flag. Ideally, for invalid bpkg files, the program should not print all hashes.

- **bpkg_invalid_ident**:   
	Due to the maximum length of the "ident" being 1024 characters, this test case verifies that when the length of "ident" exceeds 1024, pkgmain should not print all hashes and should exit with a non-zero status code.

- **bpkg_invalid_size**: 
	This test case verifies that when the filesize field of the `bpkg` file contains letters, pkgmain should detect this as invalid and exit with a non-zero exit code.
	
- **bpkg_invalid_nhashes**:  
	For this test, if the value of the `nchunks` field contains letters in the `.bpkg` file provided , `pkgmain` should detect that this is illegal, exit with a non-zero exit code, and should not generate a `Merkle tree`.

- **bpkg_invalid_hash**:  
	For this test, in the `.bpkg` file provided, one of the hashes in the `hashes` field exceeds `64` characters in length and contains letters. `pkgmain` should detect that this is illegal, exit with a non-zero exit code, and should not generate a Merkle tree.

- **bpkg_invalid_nchunks**:  
	For this test, if the value of the `nchunks` field contains letters in the `.bpkg` file provided, `pkgmain` should detect that this is illegal, exit with a non-zero exit code, and should not generate a `Merkle tree`.

- **bpkg_invalid_chunk**:    
	For this test, in the `bpkg` file provided, ione of the chunks in the chunks field exceeds 64 characters and contains letters.  In this case `pkgmain` should detect this as illegal and exit with a non-zero exit code without printing anything.
	
